
text = """
Napoleon Bonaparte (/nəˈpoʊliən ˈboʊnəpɑːrt/;[1] French: Napoléon [napɔleɔ̃ bɔnapaʁt]; 15 August 1769 – 5 May 1821), born Napoleone di Buonaparte (Italian: [napoleˈoːne di ˌbwɔnaˈparte]), byname "Le Corse" (The Corsican) or "Le Petit Caporal" (The Little Corporal), was a French statesman and military leader who became notorious as an artillery commander during the French Revolution. He led many successful campaigns during the French Revolutionary Wars and was Emperor of the French as Napoleon I from 1804 until 1814 and again briefly in 1815 during the Hundred Days. Napoleon dominated European and global affairs for more than a decade while leading France against a series of coalitions during the Napoleonic Wars. He won many of these wars and a vast majority of his battles, building a large empire that ruled over much of continental Europe before its final collapse in 1815. He is regarded as one of the greatest military commanders in history, and his wars and campaigns are studied at military schools worldwide. Napoleon's political and cultural legacy has made him one of the most celebrated and controversial leaders in human history.[2][3]

Corsican by birth, Napoleon was born into a relatively modest family of Italian origin a few months after the island was annexed by the Kingdom of France. He was serving as an artillery officer in the French Royal Army when the French Revolution erupted in 1789. He rapidly rose through the ranks of the military, seizing the new opportunities presented by the Revolution and becoming a general at age 24. The French Directory eventually gave him command of the Army of Italy after he suppressed the 13 Vendémiaire revolt against the government by royalist insurgents. At age 26, he began his first military campaign against the Austrians and the Italian monarchs aligned with the Habsburgs—winning virtually every battle, conquering the Italian Peninsula in a year while establishing "sister republics" with local support, and becoming a war hero in France.

In 1798, he led a military expedition to Egypt that served as a springboard to political power. He orchestrated a coup in November 1799 and became First Consul of the Republic. After the Peace of Amiens in 1802, Napoleon turned his attention to France's colonies. He sold the Louisiana Territory to the United States, and he attempted to restore slavery to the French Caribbean colonies. However, while he was successful in restoring slavery in the eastern Caribbean, Napoleon failed in his attempts to subdue Saint-Domingue, and the colony that France once proudly boasted of as the "Pearl of the Antilles" became independent as Haiti in 1804. Napoleon's ambition and public approval inspired him to go further, and he became the first Emperor of the French in 1804. Intractable differences with the British meant that the French were facing a Third Coalition by 1805. Napoleon shattered this coalition with decisive victories in the Ulm Campaign and a historic triumph over the Russian Empire and Austrian Empire at the Battle of Austerlitz which led to the dissolution of the Holy Roman Empire.

Napoleon formed the Franco-Persian alliance and wanted to re-establish the Franco-Indian alliances with the Muslim Indian emperor Tipu Sultan by providing a French-trained army during the Anglo-Mysore Wars, with the continuous aim of having an eventual open way to attack the British in India.[4][5] In 1806, the Fourth Coalition took up arms against him because Prussia became worried about French continental expansion. Napoleon quickly defeated Prussia at the battles of Jena and Auerstedt, then marched his Grande Armée deep into Eastern Europe and annihilated the Russians in June 1807 at the Battle of Friedland. France then forced the defeated nations of the Fourth Coalition to sign the Treaties of Tilsit in July 1807, bringing an uneasy peace to the continent. Tilsit signified the high-water mark of the French Empire. In 1809, the Austrians and the British challenged the French again during the War of the Fifth Coalition, but Napoleon solidified his grip over Europe after triumphing at the Battle of Wagram in July.

Napoleon then occupied the Iberian Peninsula, hoping to extend the Continental System and choke off British trade with the European mainland, and declared his brother Joseph Bonaparte the King of Spain in 1808. The Spanish and the Portuguese revolted with British support. The Peninsular War lasted six years, featured extensive guerrilla warfare, and ended in victory for the Allies in 1814. The Continental System caused recurring diplomatic conflicts between France and its client states, especially Russia. The Russians were unwilling to bear the economic consequences of reduced trade and routinely violated the Continental System, enticing Napoleon into another war. The French launched a major invasion of Russia in the summer of 1812. The campaign destroyed Russian cities, but did not yield the decisive victory Napoleon wanted. It resulted in the collapse of the Grande Armée and inspired a renewed push against Napoleon by his enemies.

In 1813, Prussia and Austria joined Russian forces in the War of the Sixth Coalition against France. A lengthy military campaign culminated in a large Allied army defeating Napoleon at the Battle of Leipzig in October 1813, but his tactical victory at the minor Battle of Hanau allowed retreat onto French soil. The Allies then invaded France and captured Paris in the spring of 1814, forcing Napoleon to abdicate in April. He was exiled to the island of Elba off the coast of Tuscany, and the Bourbon dynasty was restored to power. Napoleon escaped from Elba in February 1815 and took control of France once again. The Allies responded by forming a Seventh Coalition which defeated him at the Battle of Waterloo in June. The British exiled him to the remote island of Saint Helena in the South Atlantic, where he died six years later at the age of 51.

Napoleon's influence on the modern world brought liberal reforms to the numerous territories that he conquered and controlled, such as the Low Countries, Switzerland, and large parts of modern Italy and Germany. He implemented fundamental liberal policies in France and throughout Western Europe. His Napoleonic Code has influenced the legal systems of more than 70 nations around the world. British historian Andrew Roberts states: "The ideas that underpin our modern world—meritocracy, equality before the law, property rights, religious toleration, modern secular education, sound finances, and so on—were championed, consolidated, codified and geographically extended by Napoleon. To them he added a rational and efficient local administration, an end to rural banditry, the encouragement of science and the arts, the abolition of feudalism and the greatest codification of laws since the fall of the Roman Empire".[
"""

text2 = """
Great Britain had broken the Peace of Amiens by declaring war on France in May 1803.[116] In December 1804, an Anglo-Swedish agreement became the first step towards the creation of the Third Coalition. By April 1805, Britain had also signed an alliance with Russia.[117] Austria had been defeated by France twice in recent memory and wanted revenge, so it joined the coalition a few months later.[118]

Before the formation of the Third Coalition, Napoleon had assembled an invasion force, the Armée d'Angleterre, around six camps at Boulogne in Northern France. He intended to use this invasion force to strike at England. They never invaded, but Napoleon's troops received careful and invaluable training for future military operations.[119] The men at Boulogne formed the core for what Napoleon later called La Grande Armée. At the start, this French army had about 200,000 men organized into seven corps, which were large field units that contained 36–40 cannons each and were capable of independent action until other corps could come to the rescue.[120]

A single corps properly situated in a strong defensive position could survive at least a day without support, giving the Grande Armée countless strategic and tactical options on every campaign. On top of these forces, Napoleon created a cavalry reserve of 22,000 organized into two cuirassier divisions, four mounted dragoon divisions, one division of dismounted dragoons, and one of light cavalry, all supported by 24 artillery pieces.[121] By 1805, the Grande Armée had grown to a force of 350,000 men,[121] who were well equipped, well trained, and led by competent officers.[122]

Napoleon knew that the French fleet could not defeat the Royal Navy in a head-to-head battle, so he planned to lure it away from the English Channel through diversionary tactics.[123] The main strategic idea involved the French Navy escaping from the British blockades of Toulon and Brest and threatening to attack the West Indies. In the face of this attack, it was hoped, the British would weaken their defence of the Western Approaches by sending ships to the Caribbean, allowing a combined Franco-Spanish fleet to take control of the channel long enough for French armies to cross and invade.[123] However, the plan unravelled after the British victory at the Battle of Cape Finisterre in July 1805. French Admiral Villeneuve then retreated to Cádiz instead of linking up with French naval forces at Brest for an attack on the English Channel.[124]

By August 1805, Napoleon had realized that the strategic situation had changed fundamentally. Facing a potential invasion from his continental enemies, he decided to strike first and turned his army's sights from the English Channel to the Rhine. His basic objective was to destroy the isolated Austrian armies in Southern Germany before their Russian allies could arrive. On 25 September, after great secrecy and feverish marching, 200,000 French troops began to cross the Rhine on a front of 260 km (160 mi).[125][126]

Austrian commander Karl Mack had gathered the greater part of the Austrian army at the fortress of Ulm in Swabia. Napoleon swung his forces to the southeast and the Grande Armée performed an elaborate wheeling movement that outflanked the Austrian positions. The Ulm Maneuver completely surprised General Mack, who belatedly understood that his army had been cut off. After some minor engagements that culminated in the Battle of Ulm, Mack finally surrendered after realizing that there was no way to break out of the French encirclement. For just 2,000 French casualties, Napoleon had managed to capture a total of 60,000 Austrian soldiers through his army's rapid marching.[127]

The Ulm Campaign is generally regarded as a strategic masterpiece and was influential in the development of the Schlieffen Plan in the late 19th century.[128] For the French, this spectacular victory on land was soured by the decisive victory that the Royal Navy attained at the Battle of Trafalgar on 21 October. After Trafalgar, Britain had total domination of the seas for the duration of the Napoleonic Wars.[citation needed]


Napoleon at the Battle of Austerlitz, by François Gérard 1805. The Battle of Austerlitz, also known as the Battle of the Three Emperors, was one of Napoleon's many victories, where the French Empire defeated the Third Coalition.
Following the Ulm Campaign, French forces managed to capture Vienna in November. The fall of Vienna provided the French a huge bounty as they captured 100,000 muskets, 500 cannons, and the intact bridges across the Danube.[129] At this critical juncture, both Tsar Alexander I and Holy Roman Emperor Francis II decided to engage Napoleon in battle, despite reservations from some of their subordinates. Napoleon sent his army north in pursuit of the Allies, but then ordered his forces to retreat so that he could feign a grave weakness.[130]

Desperate to lure the Allies into battle, Napoleon gave every indication in the days preceding the engagement that the French army was in a pitiful state, even abandoning the dominant Pratzen Heights near the village of Austerlitz. At the Battle of Austerlitz, in Moravia on 2 December, he deployed the French army below the Pratzen Heights and deliberately weakened his right flank, enticing the Allies to launch a major assault there in the hopes of rolling up the whole French line. A forced march from Vienna by Marshal Davout and his III Corps plugged the gap left by Napoleon just in time.[130]

Meanwhile, the heavy Allied deployment against the French right flank weakened their center on the Pratzen Heights, which was viciously attacked by the IV Corps of Marshal Soult. With the Allied center demolished, the French swept through both enemy flanks and sent the Allies fleeing chaotically, capturing thousands of prisoners in the process. The battle is often seen as a tactical masterpiece because of the near-perfect execution of a calibrated but dangerous plan—of the same stature as Cannae, the celebrated triumph by Hannibal some 2,000 years before.[130]

The Allied disaster at Austerlitz significantly shook the faith of Emperor Francis in the British-led war effort. France and Austria agreed to an armistice immediately and the Treaty of Pressburg followed shortly after on 26 December. Pressburg took Austria out of both the war and the Coalition while reinforcing the earlier treaties of Campo Formio and of Lunéville between the two powers. The treaty confirmed the Austrian loss of lands to France in Italy and Bavaria, and lands in Germany to Napoleon's German allies. It also imposed an indemnity of 40 million francs on the defeated Habsburgs and allowed the fleeing Russian troops free passage through hostile territories and back to their home soil. Napoleon went on to say, "The battle of Austerlitz is the finest of all I have fought".[131] Frank McLynn suggests that Napoleon was so successful at Austerlitz that he lost touch with reality, and what used to be French foreign policy became a "personal Napoleonic one".[132] Vincent Cronin disagrees, stating that Napoleon was not overly ambitious for himself, "he embodied the ambitions of thirty million Frenchmen".[133]
"""

class Code(list):
    def __init__(self, text, iterations=50, delimiters=" ,.?!()[]"):
        for char in set(text):
            self.append(char)
        encoded_text = []
        for char in text:
            encoded_text.append(self.index(char))
        for step in range(iterations):
            pairs = {}
            pair_indexs = {}
            for idx in range(1, len(encoded_text)):
                pair = (encoded_text[idx - 1], encoded_text[idx])
                if self[pair[0]] in delimiters or self[pair[1]] in delimiters:
                    continue
                if pair not in pairs:
                    pairs[pair] = 0
                    pair_indexs[pair] = []
                pairs[pair] += 1
                pair_indexs[pair].append(idx - 1)
            best = max(pairs, key=pairs.get)
            self.append(''.join([self[best[0]], self[best[1]]]))
            print(f'BEST = "{self[-1]}"')
            before_length = len(encoded_text)
            offset = 0
            for p_idx in pair_indexs[best]:
                idx = p_idx - offset
                encoded_text = encoded_text[:idx] + [len(self) - 1] + encoded_text[idx+2:]
                offset += 1
            print(f'reduction : {before_length - len(encoded_text)}')

    def __call__(self, text):
        encoded_text = []
        while text:
            not_found = True
            for idx in reversed(range(len(self))):
                if text.startswith(self[idx]):
                    text = text[len(self[idx]):]
                    encoded_text.append(idx)
                    not_found = False
                    break
            if not_found:
                encoded_text.append(-1)
                text = text[1:]
        return encoded_text

    def decode(self, encoded_text, unknown='<unk>'):
        text = ""
        for idx in encoded_text:
            if idx < 0:
                text += unknown
            else:
                text += self[idx]
        return text


code = Code(text, iterations=200)
encoded_text2 = code(text2)
print(encoded_text2)
print(len(text2), len(encoded_text2))
print(code.decode(encoded_text2))
